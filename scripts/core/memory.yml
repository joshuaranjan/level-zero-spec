--- #--------------------------------------------------------------------------
type: header
desc: "Intel $Xx Driver APIs for Memory"
--- #--------------------------------------------------------------------------
type: function
desc: "Allocates memory that is shared between the host and one or more devices"
name: $xSharedMemAlloc
analogue:
    - "**cudaMallocManaged**"
details:
    - "Shared allocations share ownership between the host and one or more devices."
    - "@todo [**Ben**] comprehend multi-tile?"
    - "The application may call this function from simultaneous threads."
    - "The implementation of this function should be lock-free."
params:
    - type: "const $x_device_handle_t"
      name: hDevice
      desc: "[in] handle of the device"
    - type: size_t
      name: size
      desc: "[in] size in bytes to allocate"
    - type: uint32_t
      name: alignment
      desc: "[in] minimum alignment in bytes for the allocation"
    - type: "void**"
      name: ptr
      desc: "[out] pointer to shared allocation"
returns:
    - $X_RESULT_ERROR_INVALID_PARAMETER:
        - "invalid handle for hDevice"
        - "unsupported allocation size"
        - "nullptr for ptr"
    - $X_RESULT_ERROR_OUT_OF_HOST_MEMORY
    - $X_RESULT_ERROR_OUT_OF_DEVICE_MEMORY
--- #--------------------------------------------------------------------------
type: function
desc: "Allocates memory specific to a device"
name: $xMemAlloc
analogue:
    - "**cudaMalloc**"
details:
    - "A device allocation is owned by a specific device."
    - "In general, a device allocation may only be accessed by the device that owns it."
    - "The application may call this function from simultaneous threads."
    - "The implementation of this function should be lock-free."
params:
    - type: "const $x_device_handle_t"
      name: hDevice
      desc: "[in] handle of the device"
    - type: size_t
      name: size
      desc: "[in] size in bytes to allocate"
    - type: uint32_t
      name: alignment
      desc: "[in] minimum alignment in bytes for the allocation"
    - type: "void**"
      name: ptr
      desc: "[out] pointer to device allocation"
returns:
    - $X_RESULT_ERROR_INVALID_PARAMETER:
        - "invalid handle for hDevice"
        - "unsupported allocation size"
        - "nullptr for ptr"
    - $X_RESULT_ERROR_OUT_OF_HOST_MEMORY
    - $X_RESULT_ERROR_OUT_OF_DEVICE_MEMORY
--- #--------------------------------------------------------------------------
type: enum
desc: "Supported host allocation flags"
name: $x_host_mem_alloc_flags_t
etors:
    - name: $X_HOST_MEM_ALLOC_DEFAULT
      value: "0"
      desc: "implicit default behavior; uses driver-based heuristics"
    - name: $X_HOST_MEM_ALLOC_WRITE_COMBINED
      value: "$X_BIT( 0 )"
      desc: "allocate the host memory as write-combined (WC)"
--- #--------------------------------------------------------------------------
type: function
desc: "Allocates host memory"
name: $xHostMemAlloc
analogue:
    - "**cudaHostAlloc**"
details:
    - "A host allocation is owned by the host process."
    - "Host allocations are accessible by the host and all devices."
    - "Host allocations are frequently used a staging areas to transfer data to or from devices."
    - "The application may call this function from simultaneous threads."
    - "The implementation of this function should be lock-free."
params:
    - type: "$x_host_mem_alloc_flags_t"
      name: flags
      desc: "[in] flags controlling specifying additional allocation controls"
    - type: size_t
      name: size
      desc: "[in] size in bytes to allocate"
    - type: uint32_t
      name: alignment
      desc: "[in] minimum alignment in bytes for the allocation"
    - type: "void**"
      name: ptr
      desc: "[out] pointer to host allocation"
returns:
    - $X_RESULT_ERROR_INVALID_PARAMETER:
        - "invalid handle for hDevice"
        - "unsupported allocation size"
        - "nullptr for ptr"
    - $X_RESULT_ERROR_OUT_OF_HOST_MEMORY
    - $X_RESULT_ERROR_OUT_OF_DEVICE_MEMORY
--- #--------------------------------------------------------------------------
type: function
desc: "Frees allocated host memory, device memory, or shared memory"
name: $xMemFree
analogue:
    - "**cudaFree**"
    - "**cudaFreeHost**"
details:
    - "The application is responsible for making sure the GPU is not currently referencing the memory before it is freed"
    - "The implementation of this function will immediately free all Host and Device allocations associated with this memory"
    - "The implementation of this function should be lock-free."
    - "@todo [**Ben**] Should the pointer passed to the $xMemFree function be const or non-const?"
params:
    - type: "const void*"
      name: ptr
      desc: "[in] pointer to memory to free"
returns:
    - $X_RESULT_ERROR_INVALID_PARAMETER:
        - "invalid pointer"
--- #--------------------------------------------------------------------------
type: enum
desc: "Memory allocation type"
name: $x_memory_type_t
etors:
    - name: $X_MEMORY_TYPE_UNKNOWN
      value: "0"
      desc: "the memory pointed to was not allocated by $Xx"
    - name: $X_MEMORY_TYPE_HOST
      desc: "the memory pointed to is a host allocation"
    - name: $X_MEMORY_TYPE_DEVICE
      desc: "the memory pointed to is a device allocation"
    - name: $X_MEMORY_TYPE_SHARED
      desc: "the memory pointed to is a shared ownership allocation"
--- #--------------------------------------------------------------------------
type: enum
desc: "Supported memory allocation query properties"
name: $x_memory_property_t
etors:
    - name: $X_MEMORY_TYPE
      value: "0"
      desc: "see $x_memory_type_t"
--- #--------------------------------------------------------------------------
type: function
desc: "Retrieves a property of an allocation"
name: $xMemGetProperty
analogue:
    - "**cudaPointerGetAttributes**"
details:
    - "The application may call this function from simultaneous threads."
    - "The implementation of this function should be lock-free."
    - "@todo [**Ben**] do we need to support additional properties: base addr, size, etc? 
       @todo [**Ben**] do we need to support querying the associated device? 
       @todo [**Ben**] should we return all attributes as a (versioned) struct instead?"
params:
    - type: "const void*"
      name: ptr
      desc: "[in] Pointer to query"
    - type: $x_memory_property_t
      name: property
      desc: "[in] Property of the allocation to query"
    - type: "uint32_t*"
      name: value
      desc: "[out] Value of the queried property"
returns:
    - $X_RESULT_ERROR_INVALID_PARAMETER:
        - "invalid pointer"
        - "invalid property"
--- #--------------------------------------------------------------------------
type: enum
desc: "Supported memory advice hints"
name: $x_memory_advice_t
etors:
    - name: $X_MEMORY_ADVICE_TBD
      value: "0"
      desc: "@todo [**Ben**] which memory advice hints could/should we support?"
--- #--------------------------------------------------------------------------
type: function
desc: "Provides advice about the use of a shared memory range"
name: $xMemAdvise
analogue:
    - "**cudaMemAdvise**"
details:
    - "Memory advice can be used to override driver heuristics to explicitly control shared memory behavior."
    - "Memory advice may only be supported at a device-specific granularity, such as at a page boundary.
       In this case, the memory range may be expanded such that the start and end of the range satisfy
       granularity requirements."
    - "The application may call this function from simultaneous threads."
    - "The implementation of this function should be lock-free."
params:
    - type: "const $x_device_handle_t"
      name: hDevice
      desc: "[in] handle of the device to apply the advice to"
    - type: "const void*"
      name: ptr
      desc: "[in] Pointer to the start of the memory range"
    - type: size_t
      name: size
      desc: "[in] Size in bytes of the memory range"
    - type: $x_memory_advice_t
      name: advice
      desc: "[in] Memory advice for the memory range"
returns:
    - $X_RESULT_ERROR_INVALID_PARAMETER:
        - "invalid handle for hDevice"
        - "invalid pointer"
        - "invalid advice"
--- #--------------------------------------------------------------------------
type: function
desc: "Creates an IPC memory handle for the specified allocation in the sending process"
name: $xIpcGetMemHandle
analogue:
    - "**cuIpcGetMemHandle**"
details:
    - "Takes a pointer to the base of a device memory allocation and exports it for use in another process."
    - "The application may call this function from simultaneous threads."
    - "The implementation of this function should be lock-free."
    - "@todo [**Ankur**] Do we have limitations on which devices / OSes support IPC functionality?"
params:
    - type: "const void*"
      name: ptr
      desc: "[in] Pointer to the device memory allocation"
    - type: $x_ipc_mem_handle_t*
      name: pIpcHandle
      desc: "[out] Returned IPC memory handle"
returns:
    - $X_RESULT_ERROR_INVALID_PARAMETER:
        - "invalid pointer"
--- #--------------------------------------------------------------------------
type: enum
desc: "Supported IPC memory flags"
name: $x_ipc_memory_flags_t
etors:
    - name: $X_IPC_MEMORY_FLAGS_NONE
      value: "0"
      desc: "No special flags"
--- #--------------------------------------------------------------------------
type: function
desc: "Opens an IPC memory handle to retrieve a device pointer in a receiving process"
name: $xIpcOpenMemHandle
analogue:
    - "**cuIpcOpenMemHandle**"
details:
    - "Takes an IPC memory handle from a sending process and associates it with a device pointer usable in this process."
    - "The device pointer in this process should not be freed with $xMemFree, but rather with $xIpcCloseMemHandle."
    - "The application may call this function from simultaneous threads."
    - "The implementation of this function should be lock-free."
params:
    - type: "const $x_device_handle_t"
      name: hDevice
      desc: "[in] handle of the device to associate with the IPC memory handle"
    - type: $x_ipc_mem_handle_t
      name: handle
      desc: "[in] IPC memory handle"
    - type: $x_ipc_memory_flags_t
      name: flags
      desc: "[in] flags controlling the operation"
    - type: "void**"
      name: ptr
      desc: "[out] pointer to device allocation in this process"
returns:
    - $X_RESULT_ERROR_INVALID_PARAMETER:
        - "invalid handle for hDevice"
        - "invalid handle for handle"
        - "invalid flags"
        - "nullptr for ptr"
--- #--------------------------------------------------------------------------
type: function
desc: "Closes an IPC memory handle in a receiving process"
name: $xIpcCloseMemHandle
analogue:
    - "**cuIpcCloseMemHandle**"
details:
    - "Closes an IPC memory handle by unmapping memory that was opened in this process using $xIpcOpenMemHandle."
    - "@todo [**Ben**] Should the pointer passed to the $xIpcCloseMemHandle function be const or non-const?"
    - "The application may call this function from simultaneous threads."
    - "The implementation of this function should be lock-free."
params:
    - type: "const $x_device_handle_t"
      name: hDevice
      desc: "[in] handle of the device to associate with the IPC memory handle"
    - type: "const void*"
      name: ptr
      desc: "[in] pointer to memory to free"
returns:
    - $X_RESULT_ERROR_INVALID_PARAMETER:
        - "invalid handle for hDevice"
        - "invalid ptr"
