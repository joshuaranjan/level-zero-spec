#
# Copyright (C) 2019 Intel Corporation
#
# SPDX-License-Identifier: MIT
#
# See YaML.md for syntax definition
#
--- #--------------------------------------------------------------------------
type: header
desc: "Intel $OneApi Level-Zero Tool APIs for System Resource Management (Sysman) - Firmware management"
--- #--------------------------------------------------------------------------
type: enum
desc: "Event types"
class: $sDevice
name: $s_event_type_flags_t
etors:
    - name: DEVICE_RESET
      desc: "Event is triggered when the driver is going to reset the device"
    - name: DEVICE_SLEEP_STATE_ENTER
      desc: "Event is triggered when the driver is about to put the device into a deep sleep state"
    - name: DEVICE_SLEEP_STATE_EXIT
      desc: "Event is triggered when the driver is waking the device up from a deep sleep state"
    - name: FREQ_THROTTLED
      desc: "Event is triggered when the frequency starts being throttled"
    - name: ENERGY_THRESHOLD_CROSSED
      desc: "Event is triggered when the energy consumption threshold is reached (use $sPowerSetEnergyThreshold() to configure)."
    - name: TEMP_CRITICAL
      desc: "Event is triggered when the critical temperature is reached (use $sTemperatureSetConfig() to configure - disabled by default)."
    - name: TEMP_THRESHOLD1
      desc: "Event is triggered when the temperature crosses threshold 1 (use $sTemperatureSetConfig() to configure - disabled by default)."
    - name: TEMP_THRESHOLD2
      desc: "Event is triggered when the temperature crosses threshold 2 (use $sTemperatureSetConfig() to configure - disabled by default)."
    - name: MEM_HEALTH
      desc: "Event is triggered when the health of device memory changes."
    - name: FABRIC_PORT_HEALTH
      desc: "Event is triggered when the health of fabric ports change."
    - name: PCI_LINK_HEALTH
      desc: "Event is triggered when the health of the PCI link changes."
    - name: RAS_CORRECTABLE_ERRORS
      desc: "Event is triggered when accelerator RAS correctable errors cross thresholds (use $sRasSetConfig() to configure - disabled by default)."
    - name: RAS_UNCORRECTABLE_ERRORS
      desc: "Event is triggered when accelerator RAS uncorrectable errors cross thresholds (use $sRasSetConfig() to configure - disabled by default)."
    - name: DEVICE_RESET_REQUIRED
      desc: "Event is triggered when the device needs to be reset (use $sDeviceGetState() to determine the reasons for the reset)."
--- #--------------------------------------------------------------------------
type: struct
desc: "Event configuration for a device"
class: $sEvent
name: $s_event_config_t
members:
    - type: $s_event_type_flags_t
      name: "registered"
      desc: |
            [in,out] List of registered events.
            Must be 0 (none) or a valid combination of $s_event_type_flag_bits_t.
--- #--------------------------------------------------------------------------
type: function
desc: "Get the event handle for the specified device"
class: $sDevice
name: CreateEvents
details:
    - "The application may call this function from simultaneous threads."
    - "The implementation of this function should be lock-free."
params:
    - type: $s_device_handle_t
      name: hDevice
      desc: "[in] Sysman handle for the device"
    - type: "$s_event_handle_t*"
      name: phEvent
      desc: "[out] The event handle for the specified device."
--- #--------------------------------------------------------------------------
type: function
desc: "Find out which events are currently registered on the specified device event handler"
class: $sEvent
name: GetConfig
details:
    - "The application may call this function from simultaneous threads."
    - "The implementation of this function should be lock-free."
params:
    - type: $s_event_handle_t
      name: hEvent
      desc: "[in] The event handle for the device"
    - type: "$s_event_config_t*"
      name: pConfig
      desc: "[in,out] Will contain the current event configuration (list of registered events)."
--- #--------------------------------------------------------------------------
type: function
desc: "Set a new event configuration (list of registered events) on the specified device event handler"
class: $sEvent
name: SetConfig
details:
    - "The application may call this function from simultaneous threads."
    - "The implementation of this function should be lock-free."
params:
    - type: $s_event_handle_t
      name: hEvent
      desc: "[in] The event handle for the device"
    - type: "const $s_event_config_t*"
      name: pConfig
      desc: "[in] New event configuration (list of registered events)."
--- #--------------------------------------------------------------------------
type: function
desc: "Get events that have been triggered for a specific device"
class: $sEvent
name: GetState
details:
    - "If events have occurred on the specified device event handle, they are returned and the corresponding event status is cleared if the argument clear = true."
    - "The application may call this function from simultaneous threads."
    - "The implementation of this function should be lock-free."
params:
    - type: $s_event_handle_t
      name: hEvent
      desc: "[in] The event handle for the device."
    - type: $x_bool_t
      name: clear
      desc: "[in] Indicates if the event list for this device should be cleared."
    - type: "$s_event_type_flags_t*"
      name: pEvents
      desc: "[in,out] Events (combination of $s_event_type_flag_bits_t) that have been triggered by this device."
--- #--------------------------------------------------------------------------
type: function
desc: "Wait for the specified list of event handles to receive any registered events"
class: $sEvent
decl: static
name: Listen
details:
    - "If previous events arrived and were not cleared using $sEventGetState(), this call will return immediately."
    - "The application may call this function from simultaneous threads."
    - "The implementation of this function should be lock-free."
params:
    - type: $x_driver_handle_t
      name: hDriver
      desc: "[in] handle of the driver instance"
    - type: uint32_t
      name: timeout
      desc: |
            [in] if non-zero, then indicates the maximum time (in milliseconds) to yield before returning $X_RESULT_SUCCESS or $X_RESULT_NOT_READY;
            if zero, then will check status and return immediately;
            if UINT32_MAX, then function will not return until events arrive or device is lost.
    - type: uint32_t
      name: count
      desc: "[in] Number of handles in phEvents"
    - type: "$s_event_handle_t*"
      name: phEvents
      desc: "[in][range(0, count)] Handle of events that should be listened to"
    - type: "$s_event_type_flags_t*"
      name: pEvents
      desc: |
            [in,out] Events (combination of $s_event_type_flag_bits_t) that have been triggered by any of the supplied event handles.
            If timeout is not UINT32_MAX and this value is 0, then a timeout has occurred.
returns:
    - $X_RESULT_ERROR_INSUFFICIENT_PERMISSIONS:
        - "User does not have permissions to listen to events."
    - $X_RESULT_ERROR_INVALID_ARGUMENT:
        - "One or more of the supplied event handles are for devices that belong to a different driver handle."
--- #--------------------------------------------------------------------------
type: class
desc: "C++ wrapper for a Sysman device event"
name: $sEvent
owner: $sDevice
members:
    - type: $s_event_handle_t
      name: handle
      desc: "[in] handle of Sysman object" 
      init: nullptr
    - type: $sDevice*
      name: pDevice
      desc: "[in] pointer to owner object"
